{
  "applicationModel": {
    "autoIncrementIds": {
      "LocalStorageConnector": 2,
      "TableView": 3,
      "InputView": 27,
      "ButtonView": 26,
      "ContainerView": 15,
      "DialogView": 2,
      "CameraView": 1,
      "ImageView": 3,
      "DatepickerView": 9,
      "TextView": 10,
      "TimeSeriesChartView": 1
    },
    "name": "expenses",
    "versionIndex": 2,
    "version": "0.0.1",
    "bootstrapStylesheetUrl": "assets/ext/themes/dlite.css",
    "darkMode": false,
    "networkSelectiveSynchronization": "ALWAYS",
    "bundleParameters": {
      "name": "default",
      "targetTenant": "cincheo.com",
      "action": "deploy",
      "upgrade": false,
      "dataDirectory": "/DATA",
      "ldap": false,
      "ldapServer": "localhost",
      "ldapServerPort": "389",
      "ldapProtocolVersion": "3",
      "ldapReferrals": "0",
      "ldapBaseDN": "dc=xxx,dc=yyy",
      "ldapAdminUID": "root",
      "keycloak": true,
      "keycloakUrl": "https://sso.dlite.io/auth",
      "keycloakRealm": "elite",
      "keycloakClientId": "daquota-app-client",
      "keycloakOnLoad": "login-required"
    },
    "savedBundleParameters": [
      {
        "name": "default",
        "targetTenant": "cincheo.com",
        "action": "deploy",
        "upgrade": false,
        "dataDirectory": "/DATA",
        "ldap": false,
        "ldapServer": "localhost",
        "ldapServerPort": "389",
        "ldapProtocolVersion": "3",
        "ldapReferrals": "0",
        "ldapBaseDN": "dc=xxx,dc=yyy",
        "ldapAdminUID": "root",
        "keycloak": true,
        "keycloakUrl": "https://sso.dlite.io/auth",
        "keycloakRealm": "elite",
        "keycloakClientId": "daquota-app-client",
        "keycloakOnLoad": "login-required"
      }
    ],
    "models": [],
    "description": "A PWA expense management app, with 18n and use of the camera. This application is meant to go mobile. You take the picture of your expense receipt, fill some info and share with your manager. The manager can accept or refuse the expense."
  },
  "roots": [
    {
      "cid": "navbar",
      "type": "NavbarView",
      "brand": "Expenses",
      "defaultPage": "index",
      "navigationItems": [
        {
          "pageId": "index",
          "label": "=$t('menu.my-expenses')",
          "kind": "Page"
        },
        {
          "label": "=$t('menu.validation')",
          "kind": "Page",
          "pageId": "validation",
          "hidden": "=!$d('globals').admin"
        },
        {
          "label": "Archive",
          "kind": "Page",
          "pageId": "archive",
          "hidden": "=!$d('globals').admin"
        }
      ],
      "eventHandlers": [],
      "hidden": false,
      "syncOnRouteChange": true,
      "showSync": true,
      "showUser": true,
      "vertical": false,
      "showLocaleSelector": true,
      "i18n": [
        "({",
        "    'en-US': {",
        "        'status.draft': 'Draft',",
        "        'status.submitted': 'Submitted',",
        "        'status.accepted': 'Accepted',",
        "        'status.rejected': 'Rejected',",
        "        'menu.my-expenses': 'My expenses',",
        "        'menu.validation': 'Validation',",
        "        'new-expense': 'New expense',",
        "        'amount': 'Amount',",
        "        'description': 'Description',",
        "        'currency': 'Currency',",
        "        'action.delete': 'Delete',",
        "        'action.submit': 'Submit',",
        "        'action.reject': 'Reject',",
        "        'action.update': 'Update expense',",
        "        'action.create': 'Create expense',",
        "        'title.create': 'Create expense',",
        "        'title.update': 'Update expense'",
        "    },",
        "    'fr-FR': {",
        "        'status.draft': 'Brouillon',",
        "        'status.submitted': 'Soumise',",
        "        'status.accepted': 'Acceptée',",
        "        'status.rejected': 'Rejetée',",
        "        'menu.my-expenses': 'Mes notes de frais',",
        "        'menu.validation': 'Validation',",
        "        'new-expense': 'Nouvelle note de frais',",
        "        'amount': 'Montant',",
        "        'description': 'Description',",
        "        'currency': 'Devise',",
        "        'action.delete': 'Supprimer',",
        "        'action.submit': 'Soumettre',",
        "        'action.reject': 'Refuser',",
        "        'action.update': 'Valider',",
        "        'action.create': 'Créer',",
        "        'title.create': 'Créer une note de frais',",
        "        'title.update': 'Modifier une note de frais'",
        "    }",
        "})"
      ]
    },
    {
      "cid": "index",
      "type": "ContainerView",
      "dataType": "object",
      "layout": "block",
      "components": [
        {
          "cid": "container-3",
          "type": "ContainerView",
          "dataType": "object",
          "layout": "block",
          "components": [
            {
              "cid": "container-2",
              "type": "ContainerView",
              "dataType": "object",
              "layout": "block",
              "components": [
                {
                  "cid": "button-3",
                  "type": "ButtonView",
                  "dataSource": "$parent",
                  "label": "=$t('new-expense')",
                  "buttonType": "button",
                  "eventHandlers": [
                    {
                      "global": false,
                      "name": "@click",
                      "actions": [
                        {
                          "targetId": "camera",
                          "name": "show",
                          "description": "",
                          "argument": "imageData => {\n    $c('create-dialog').show({\n        status: \"NEW\",\n        date: moment().format('YYYY-MM-DD'),\n        photoUrl: imageData,\n        userId: $collab.getLoggedUser().id,\n        firstName: $collab.getLoggedUser().firstName,\n        lastName: $collab.getLoggedUser().lastName,\n        email: $collab.getLoggedUser().email,\n        currency: \"EUR\",\n        amount: 0 \n    });\n}"
                        }
                      ]
                    }
                  ],
                  "block": false,
                  "variant": "primary",
                  "icon": "camera",
                  "size": "lg",
                  "pill": true,
                  "layoutClass": "text-center m-2"
                },
                {
                  "cid": "my-expenses-table",
                  "type": "TableView",
                  "dataType": "array",
                  "fields": [
                    {
                      "key": "status",
                      "label": "",
                      "hidden": false,
                      "customComponent": true,
                      "class": "text-center",
                      "thStyle": "width:5%"
                    },
                    {
                      "key": "id",
                      "label": "Id",
                      "formatterExpression": "value => value.split('-')[0]",
                      "hidden": true,
                      "sortable": true
                    },
                    {
                      "key": "date",
                      "label": "Date",
                      "customComponent": false,
                      "sortable": true,
                      "formatterExpression": "value => '<span style=\"white-space: nowrap;\">'+moment(value).format(\"YYYY-MM-DD\")+'</span>'",
                      "thStyle": "width:10%"
                    },
                    {
                      "key": "amount",
                      "label": "=$t('amount')",
                      "formatterExpression": "",
                      "customComponent": true,
                      "sortable": true,
                      "thStyle": "text-align: right; width:20%; padding-right: 1.5rem"
                    },
                    {
                      "key": "description",
                      "label": "=$t('description')"
                    },
                    {
                      "key": "location",
                      "label": "Location",
                      "hidden": true
                    },
                    {
                      "key": "actions",
                      "label": " ",
                      "customComponent": true,
                      "thStyle": "width: 5%",
                      "class": "text-center"
                    }
                  ],
                  "defaultValue": [
                    "=([",
                    "        {x: \"a\", data1: 30, data2: 4}, ",
                    "        {x: \"b\", data1: 37, data2: 12},",
                    "        {x: \"c\", data1: 22, data2: 8}",
                    "])"
                  ],
                  "eventHandlers": [],
                  "selectMode": "single",
                  "dataSource": [
                    "=$d('expenses-storage')",
                    "    .filter(expense => !expense.$sharedBy ",
                    "        || expense.$sharedBy === $collab.getLoggedUser().email",
                    "    )"
                  ],
                  "stacked": "md",
                  "customComponent_actions": {
                    "cid": "container-4",
                    "type": "ContainerView",
                    "dataType": "object",
                    "layout": "block",
                    "components": [
                      {
                        "cid": "button-1",
                        "type": "ButtonView",
                        "dataSource": "$parent",
                        "buttonType": "button",
                        "eventHandlers": [
                          {
                            "global": false,
                            "name": "@click",
                            "actions": [
                              {
                                "targetId": "edit-dialog",
                                "name": "show",
                                "description": "",
                                "argument": "$d(this)"
                              }
                            ]
                          }
                        ],
                        "block": false,
                        "disabled": false,
                        "icon": "pencil",
                        "pill": true,
                        "size": "=this.screenWidth < MD ? 'lg' : 'sm'",
                        "hidden": false
                      },
                      {
                        "cid": "button-4",
                        "type": "ButtonView",
                        "dataSource": "$parent",
                        "buttonType": "button",
                        "eventHandlers": [
                          {
                            "global": false,
                            "name": "@click",
                            "actions": [
                              {
                                "targetId": "expenses-storage",
                                "name": "removeData",
                                "description": "",
                                "condition": "",
                                "argument": "$d(this)"
                              }
                            ]
                          }
                        ],
                        "block": false,
                        "variant": "danger",
                        "icon": "trash",
                        "disabled": false,
                        "pill": true,
                        "size": "=this.screenWidth < MD ? 'lg' : 'sm'",
                        "hidden": false
                      },
                      {
                        "cid": "button-5",
                        "type": "ButtonView",
                        "dataSource": "$parent",
                        "label": "=$tools.icon('reply', {flipH:true})",
                        "buttonType": "button",
                        "eventHandlers": [
                          {
                            "global": false,
                            "name": "@click",
                            "actions": [
                              {
                                "targetId": "$self",
                                "name": "setFieldData",
                                "condition": "confirm('Are you sure you want to submit this expense for validation?')",
                                "argument": "'status', 'SUBMITTED'",
                                "stopIfConditionIsFalse": true
                              }
                            ]
                          }
                        ],
                        "pill": true,
                        "size": "=this.screenWidth < MD ? 'lg' : 'sm'",
                        "variant": "primary"
                      }
                    ],
                    "defaultValue": "={}",
                    "dataSource": "$parent",
                    "eventHandlers": [],
                    "direction": "row",
                    "rowGap": "",
                    "columnGap": "0.2rem",
                    "justify": "center",
                    "layoutClass": "w-100",
                    "class": "",
                    "hidden": "=!($d(this).status === 'NEW' || $d(this).status === 'REJECTED')"
                  },
                  "striped": true,
                  "outlined": true,
                  "bordered": false,
                  "customComponent_amount": {
                    "cid": "input-17",
                    "type": "InputView",
                    "dataType": "number",
                    "inputType": "formatted-number",
                    "size": "sm",
                    "disabled": true,
                    "eventHandlers": [],
                    "dataSource": "$parent",
                    "field": "amount",
                    "numberStyle": "currency",
                    "currency": "=$d(parent).currency",
                    "class": "m-0",
                    "currencyDisplay": "symbol",
                    "horizontalLayout": false,
                    "showInputOnClick": true,
                    "layoutClass": "=this.screenWidth > MD ? 'text-right pr-3': ''"
                  },
                  "small": true,
                  "notSelectable": true,
                  "customComponent_date": {
                    "cid": "datepicker-2",
                    "type": "DatepickerView",
                    "dataType": "date",
                    "eventHandlers": [],
                    "size": "sm",
                    "dataSource": "$parent",
                    "field": "date",
                    "dateFormatOptions": "\"YYYY-MM-DD\"",
                    "disabled": true
                  },
                  "customComponent_status": {
                    "cid": "text-0",
                    "type": "TextView",
                    "dataType": "string",
                    "tag": "div",
                    "text": "=$c('globals').statusBadge($d(this))",
                    "eventHandlers": [],
                    "dataSource": "$parent",
                    "field": "status"
                  },
                  "hidden": "=this.screenWidth <= MD || $d(this).length === 0",
                  "emptyText": "",
                  "class": "=this.screenWidth < MD ? 'fs-5' : ''"
                },
                {
                  "cid": "my-expenses-table-md",
                  "type": "TableView",
                  "dataType": "array",
                  "fields": [
                    {
                      "key": "_",
                      "label": "",
                      "customComponent": true
                    },
                    {
                      "key": "actions",
                      "label": " ",
                      "customComponent": true,
                      "hidden": true,
                      "thStyle": "width: 5%",
                      "class": "text-center"
                    }
                  ],
                  "defaultValue": [
                    "=([",
                    "        {x: \"a\", data1: 30, data2: 4}, ",
                    "        {x: \"b\", data1: 37, data2: 12},",
                    "        {x: \"c\", data1: 22, data2: 8}",
                    "])"
                  ],
                  "eventHandlers": [],
                  "selectMode": "single",
                  "dataSource": [
                    "=$d('expenses-storage')",
                    "    .filter(expense => !expense.$sharedBy ",
                    "        || expense.$sharedBy === $collab.getLoggedUser().email",
                    "    )"
                  ],
                  "customComponent_actions": {
                    "cid": "container-10",
                    "type": "ContainerView",
                    "dataType": "object",
                    "layout": "block",
                    "components": [
                      {
                        "cid": "button-13",
                        "type": "ButtonView",
                        "dataSource": "$parent",
                        "buttonType": "button",
                        "eventHandlers": [
                          {
                            "global": false,
                            "name": "@click",
                            "actions": [
                              {
                                "targetId": "edit-dialog",
                                "name": "show",
                                "description": "",
                                "argument": "$d(this)"
                              }
                            ]
                          }
                        ],
                        "block": false,
                        "disabled": false,
                        "icon": "pencil",
                        "pill": true,
                        "size": "=this.screenWidth < MD ? 'lg' : 'sm'",
                        "hidden": false
                      },
                      {
                        "cid": "button-14",
                        "type": "ButtonView",
                        "dataSource": "$parent",
                        "buttonType": "button",
                        "eventHandlers": [
                          {
                            "global": false,
                            "name": "@click",
                            "actions": [
                              {
                                "targetId": "expenses-storage",
                                "name": "removeData",
                                "description": "",
                                "condition": "",
                                "argument": "$d(this)"
                              }
                            ]
                          }
                        ],
                        "block": false,
                        "variant": "danger",
                        "icon": "trash",
                        "disabled": false,
                        "pill": true,
                        "size": "=this.screenWidth < MD ? 'lg' : 'sm'",
                        "hidden": false
                      },
                      {
                        "cid": "button-15",
                        "type": "ButtonView",
                        "dataSource": "$parent",
                        "label": "=$tools.icon('reply', {flipH:true})",
                        "buttonType": "button",
                        "eventHandlers": [
                          {
                            "global": false,
                            "name": "@click",
                            "actions": [
                              {
                                "targetId": "$self",
                                "name": "setFieldData",
                                "condition": "confirm('Are you sure you want to submit this expense for validation?')",
                                "argument": "'status', 'SUBMITTED'"
                              }
                            ]
                          }
                        ],
                        "pill": true,
                        "size": "=this.screenWidth < MD ? 'lg' : 'sm'",
                        "variant": "primary"
                      }
                    ],
                    "defaultValue": "={}",
                    "dataSource": "$parent",
                    "eventHandlers": [],
                    "direction": "row",
                    "rowGap": "",
                    "columnGap": "0.2rem",
                    "justify": "center",
                    "layoutClass": "w-100",
                    "class": "",
                    "hidden": "=!($d(this).status === 'NEW' || $d(this).status === 'REJECTED')"
                  },
                  "striped": true,
                  "outlined": true,
                  "bordered": false,
                  "customComponent_amount": {
                    "cid": "input-23",
                    "type": "InputView",
                    "dataType": "number",
                    "inputType": "formatted-number",
                    "size": "sm",
                    "disabled": true,
                    "eventHandlers": [],
                    "dataSource": "$parent",
                    "field": "amount",
                    "numberStyle": "currency",
                    "currency": "=$d(parent).currency",
                    "class": "m-0",
                    "currencyDisplay": "symbol",
                    "horizontalLayout": false,
                    "showInputOnClick": true,
                    "layoutClass": "=this.screenWidth > MD ? 'text-right pr-3': ''"
                  },
                  "small": true,
                  "notSelectable": true,
                  "customComponent_date": {
                    "cid": "datepicker-6",
                    "type": "DatepickerView",
                    "dataType": "date",
                    "eventHandlers": [],
                    "size": "sm",
                    "dataSource": "$parent",
                    "field": "date",
                    "dateFormatOptions": "\"YYYY-MM-DD\"",
                    "disabled": true
                  },
                  "customComponent_status": {
                    "cid": "text-5",
                    "type": "TextView",
                    "dataType": "string",
                    "tag": "div",
                    "text": "=$c('globals').statusBadge($d(this))",
                    "eventHandlers": [],
                    "dataSource": "$parent",
                    "field": "status"
                  },
                  "hidden": "=this.screenWidth > MD || $d(this).length === 0",
                  "emptyText": "",
                  "class": "fs-6",
                  "customComponent__": {
                    "cid": "container-11",
                    "type": "ContainerView",
                    "dataType": "array",
                    "layout": "block",
                    "components": [
                      {
                        "cid": "text-6",
                        "type": "TextView",
                        "dataType": "string",
                        "tag": "div",
                        "text": "=$c('globals').statusBadge($d(this))",
                        "eventHandlers": [],
                        "dataSource": "$parent",
                        "field": "status"
                      },
                      {
                        "cid": "text-7",
                        "type": "TextView",
                        "tag": "div",
                        "text": "=`${moment($d(this).date).format(\"YYYY-MM-DD\")} ${$tools.icon('dot')} ${$d(this).description}`",
                        "eventHandlers": [],
                        "dataSource": "$parent"
                      },
                      {
                        "cid": "input-24",
                        "type": "InputView",
                        "dataType": "number",
                        "inputType": "formatted-number",
                        "size": "sm",
                        "disabled": true,
                        "eventHandlers": [],
                        "dataSource": "$parent",
                        "field": "amount",
                        "numberStyle": "currency",
                        "currency": "=$d(parent).currency",
                        "class": "m-0 font-weight-bolder",
                        "currencyDisplay": "symbol",
                        "horizontalLayout": false,
                        "showInputOnClick": true,
                        "layoutClass": "text-right"
                      }
                    ],
                    "defaultValue": "={}",
                    "dataSource": "$parent",
                    "eventHandlers": [
                      {
                        "global": false,
                        "name": "@click",
                        "actions": [
                          {
                            "targetId": "edit-dialog",
                            "name": "show",
                            "argument": "$d(this)",
                            "condition": "($d(this).status === 'NEW' || $d(this).status === 'REJECTED')"
                          }
                        ]
                      }
                    ]
                  }
                },
                {
                  "cid": "text-2",
                  "type": "TextView",
                  "dataType": "string",
                  "tag": "alert",
                  "text": "No ongoing expenses yet.",
                  "eventHandlers": [],
                  "hidden": "=$d('my-expenses-table').length > 0"
                }
              ],
              "defaultValue": "={}",
              "eventHandlers": [],
              "class": "=this.screenWidth <= 800 ? 'p-0' : ''"
            },
            {
              "cid": "edit-dialog",
              "type": "DialogView",
              "title": "=$t('title.update')",
              "content": {
                "cid": "update-form",
                "type": "ContainerView",
                "dataType": "object",
                "layout": "block",
                "components": [
                  {
                    "cid": "container-12",
                    "type": "ContainerView",
                    "dataType": "object",
                    "layout": "block",
                    "components": [
                      {
                        "cid": "button-17",
                        "type": "ButtonView",
                        "dataSource": "$parent",
                        "buttonType": "button",
                        "eventHandlers": [
                          {
                            "global": false,
                            "name": "@click",
                            "actions": [
                              {
                                "targetId": "expenses-storage",
                                "name": "removeData",
                                "description": "",
                                "condition": "",
                                "argument": "$d(this)"
                              },
                              {
                                "targetId": "edit-dialog",
                                "name": "hide",
                                "argument": ""
                              }
                            ]
                          }
                        ],
                        "block": false,
                        "variant": "danger",
                        "icon": "trash",
                        "disabled": false,
                        "pill": true,
                        "hidden": false,
                        "label": "=$t('action.delete')"
                      },
                      {
                        "cid": "button-18",
                        "type": "ButtonView",
                        "dataSource": "$parent",
                        "label": "=$tools.icon('reply', {flipH:true}) + ' ' + $t('action.submit')",
                        "buttonType": "submit",
                        "eventHandlers": [
                          {
                            "global": false,
                            "name": "@click",
                            "actions": [
                              {
                                "targetId": "$self",
                                "name": "setFieldData",
                                "condition": "confirm('Are you sure you want to submit this expense for validation?')",
                                "argument": "'status', 'SUBMITTED'"
                              }
                            ]
                          }
                        ],
                        "pill": true,
                        "variant": "primary"
                      }
                    ],
                    "defaultValue": "={}",
                    "dataSource": "$parent",
                    "eventHandlers": [],
                    "direction": "row",
                    "rowGap": "",
                    "columnGap": "0.2rem",
                    "justify": "center",
                    "layoutClass": "w-100",
                    "class": "",
                    "hidden": "=!($d(this).status === 'NEW' || $d(this).status === 'REJECTED')"
                  },
                  {
                    "cid": "input-7",
                    "type": "InputView",
                    "dataType": "string",
                    "inputType": "text",
                    "disabled": true,
                    "eventHandlers": [],
                    "field": "id",
                    "dataSource": "$parent",
                    "label": "Id"
                  },
                  {
                    "cid": "datepicker-0",
                    "type": "DatepickerView",
                    "dataType": "datetime",
                    "eventHandlers": [],
                    "label": "Date",
                    "dataSource": "$parent",
                    "field": "date",
                    "disabled": "=!($d(parent).status === 'NEW' || $d(parent).status === 'REJECTED')"
                  },
                  {
                    "cid": "input-0",
                    "type": "InputView",
                    "dataType": "string",
                    "inputType": "text",
                    "disabled": "=!($d(parent).status === 'NEW' || $d(parent).status === 'REJECTED')",
                    "eventHandlers": [],
                    "field": "description",
                    "dataSource": "$parent",
                    "label": "=$t('description')",
                    "numberStyle": "currency",
                    "locale": "=$d('currency-selector1')"
                  },
                  {
                    "cid": "currency-selector1",
                    "type": "SelectView",
                    "dataType": "string",
                    "inputType": "text",
                    "disabled": "=!($d(parent).status === 'NEW' || $d(parent).status === 'REJECTED')",
                    "eventHandlers": [],
                    "field": "currency",
                    "dataSource": "$parent",
                    "label": "=$t('currency')",
                    "options": [
                      "Intl.supportedValuesOf('currency').map(currency => ({",
                      "    text: currency + ' (' + ide.currencies.find(c => c.cc === currency)?.name + ')',",
                      "    value: currency",
                      "}))"
                    ]
                  },
                  {
                    "cid": "input-16",
                    "type": "InputView",
                    "dataType": "number",
                    "inputType": "formatted-number",
                    "disabled": "=!($d(parent).status === 'NEW' || $d(parent).status === 'REJECTED')",
                    "eventHandlers": [],
                    "field": "amount",
                    "dataSource": "$parent",
                    "label": "=$t('amount')",
                    "numberStyle": "currency",
                    "currency": "=$d('currency-selector')",
                    "currencyDisplay": "symbol",
                    "state": "=$d(this) > 0",
                    "invalidFeedback": "Not a valid amount"
                  },
                  {
                    "cid": "image-1",
                    "type": "ImageView",
                    "blank": false,
                    "display": "fluid",
                    "layoutClass": "text-center",
                    "eventHandlers": [],
                    "dataSource": "$parent",
                    "field": "photoUrl",
                    "defaultImage": true
                  },
                  {
                    "cid": "button-0",
                    "type": "ButtonView",
                    "dataSource": "$parent",
                    "label": "=$t('action.update')",
                    "buttonType": "submit",
                    "eventHandlers": [],
                    "block": true,
                    "variant": "primary",
                    "icon": "check",
                    "layoutStyle": "",
                    "layoutClass": "mt-2",
                    "hidden": "=!($d(parent).status === 'NEW' || $d(parent).status === 'REJECTED')"
                  }
                ],
                "defaultValue": "={}",
                "eventHandlers": [
                  {
                    "global": false,
                    "name": "@submit",
                    "actions": [
                      {
                        "targetId": "expenses-storage",
                        "name": "replaceData",
                        "description": "",
                        "condition": "",
                        "argument": "$d(this)"
                      },
                      {
                        "targetId": "edit-dialog",
                        "name": "hide",
                        "description": "Close dialog",
                        "argument": "",
                        "condition": ""
                      }
                    ]
                  }
                ],
                "dataSource": "$parent",
                "form": true,
                "class": "",
                "layoutClass": "=this.screenWidth < MD ? 'fs-5' : ''"
              },
              "eventHandlers": [],
              "size": "xl",
              "scrollable": true,
              "class": ""
            },
            {
              "cid": "create-dialog",
              "type": "DialogView",
              "title": "=$t('title.create')",
              "content": {
                "cid": "container-1",
                "type": "ContainerView",
                "dataType": "object",
                "layout": "block",
                "components": [
                  {
                    "cid": "image-0",
                    "type": "ImageView",
                    "blank": false,
                    "display": "fluid",
                    "layoutClass": "text-center",
                    "eventHandlers": [],
                    "dataSource": "$parent",
                    "field": "photoUrl",
                    "defaultImage": true
                  },
                  {
                    "cid": "datepicker-1",
                    "type": "DatepickerView",
                    "dataType": "datetime",
                    "eventHandlers": [],
                    "label": "Date",
                    "dataSource": "$parent",
                    "field": "date"
                  },
                  {
                    "cid": "input-8",
                    "type": "InputView",
                    "dataType": "string",
                    "inputType": "text",
                    "size": "default",
                    "disabled": false,
                    "eventHandlers": [],
                    "field": "description",
                    "dataSource": "$parent",
                    "label": "=$t('description')",
                    "required": true
                  },
                  {
                    "cid": "currency-selector",
                    "type": "SelectView",
                    "dataType": "string",
                    "inputType": "text",
                    "size": "default",
                    "disabled": false,
                    "eventHandlers": [],
                    "field": "currency",
                    "dataSource": "$parent",
                    "label": "=$t('currency')",
                    "options": [
                      "Intl.supportedValuesOf('currency').map(currency => ({",
                      "    text: currency + ' (' + ide.currencies.find(c => c.cc === currency)?.name + ')',",
                      "    value: currency",
                      "}))"
                    ]
                  },
                  {
                    "cid": "input-13",
                    "type": "InputView",
                    "dataType": "number",
                    "inputType": "formatted-number",
                    "size": "default",
                    "disabled": false,
                    "eventHandlers": [],
                    "field": "amount",
                    "dataSource": "$parent",
                    "label": "=$t('amount')",
                    "numberStyle": "currency",
                    "currency": "=$d('currency-selector')",
                    "currencyDisplay": "symbol",
                    "state": "=$d(this) > 0",
                    "invalidFeedback": "Not a valid amount"
                  },
                  {
                    "cid": "button-2",
                    "type": "ButtonView",
                    "dataSource": "$parent",
                    "label": "=$t('action.create')",
                    "buttonType": "submit",
                    "eventHandlers": [],
                    "block": true,
                    "variant": "primary",
                    "icon": "plus"
                  }
                ],
                "defaultValue": "={}",
                "eventHandlers": [
                  {
                    "global": false,
                    "name": "@submit",
                    "actions": [
                      {
                        "targetId": "expenses-storage",
                        "name": "addData",
                        "description": "",
                        "argument": "$d(this)",
                        "condition": ""
                      },
                      {
                        "targetId": "create-dialog",
                        "name": "hide",
                        "description": "",
                        "argument": ""
                      }
                    ]
                  }
                ],
                "dataSource": "$parent",
                "form": true,
                "layoutClass": "=this.screenWidth < MD ? 'fs-5' : ''"
              },
              "eventHandlers": [],
              "size": "xl",
              "scrollable": true
            }
          ],
          "defaultValue": "={}",
          "eventHandlers": []
        }
      ],
      "defaultValue": "={}",
      "eventHandlers": []
    },
    {
      "cid": "globals",
      "type": "ContainerView",
      "dataType": "object",
      "layout": "block",
      "components": [
        {
          "cid": "expenses-storage",
          "type": "LocalStorageConnector",
          "dataType": "array",
          "autoIds": true,
          "defaultValue": [
            "=([",
            "    {",
            "        description: \"A test expense\",",
            "        amount: \"100\",",
            "        currency: \"EUR\",",
            "        location: \"110 place de la Concorde, Paris\",",
            "        date: $tools.now(),",
            "        userId: $collab.getLoggedUser().id,",
            "        firstName: $collab.getLoggedUser().firstName,",
            "        lastName: $collab.getLoggedUser().lastName,",
            "        email: $collab.getLoggedUser().email,",
            "        photoUrl: \"https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.pinterest.com%2Fpin%2F127578601930817912%2F&psig=AOvVaw2DVpM2GklX4Qt-gVbVUkRP&ust=1678418955120000&source=images&cd=vfe&ved=0CBAQjRxqFwoTCKibzv7zzf0CFQAAAAAdAAAAABAK\",",
            "        status: \"NEW\"",
            "    }    ",
            "])"
          ],
          "eventHandlers": [],
          "key": "=[\"expenses\", \"ongoing\"]",
          "autoSync": true,
          "partitionKey": "id",
          "shares": "(id, expense) => {\n    if (expense.status !== 'NEW') {\n        return \"#expenses#cincheo.com\";\n    }\n}"
        },
        {
          "cid": "camera",
          "type": "CameraView",
          "width": 320,
          "eventHandlers": [],
          "dialogSize": "xl"
        },
        {
          "cid": "archived-expenses-storage",
          "type": "LocalStorageConnector",
          "dataType": "array",
          "autoIds": true,
          "defaultValue": "=[]",
          "eventHandlers": [],
          "autoSync": true,
          "key": "=[\"expenses\", \"archived\"]"
        }
      ],
      "defaultValue": "={}",
      "eventHandlers": [],
      "init": [
        "$collab.groupMembers('#expenses#cincheo.com')",
        "    .then(members => {",
        "        if (members.includes($collab.getLoggedUser().email)) {",
        "            $set($d(this), 'admin', true);",
        "        }",
        "})",
        "",
        "this.define('statusBadge', (status) => {",
        "    switch (status) {",
        "        case 'NEW':",
        "            return `<div class=\"fs-6 badge badge-secondary\">${$t('status.draft')}</div>`;",
        "        case 'SUBMITTED':",
        "            return `<div class=\"fs-6 badge badge-info\">${$t('status.submitted')}</div>`;",
        "        case 'REJECTED':",
        "            return `<div class=\"fs-6 badge badge-warning\">${$t('status.rejected')}</div>`;",
        "        case 'ACCEPTED':",
        "            return `<div class=\"fs-6 badge badge-success\">${$t('status.accepted')}</div>`;",
        "        default:",
        "            return '';",
        "    }",
        "});"
      ]
    },
    {
      "cid": "validation",
      "type": "ContainerView",
      "dataType": "object",
      "layout": "block",
      "components": [
        {
          "cid": "validation-table",
          "type": "TableView",
          "dataType": "array",
          "fields": [
            {
              "key": "status",
              "label": "",
              "hidden": false,
              "customComponent": true,
              "class": "text-center",
              "thStyle": "width:5%"
            },
            {
              "key": "id",
              "label": "Id",
              "formatterExpression": "value => value.split('-')[0]",
              "hidden": true,
              "sortable": true
            },
            {
              "key": "date",
              "label": "Date",
              "customComponent": false,
              "sortable": true,
              "formatterExpression": "value => '<span style=\"white-space: nowrap;\">'+moment(value).format(\"YYYY-MM-DD\")+'</span>'",
              "thStyle": "width:10%"
            },
            {
              "key": "creator",
              "label": "Creator",
              "formatterExpression": "(value, key, item) => `${item.firstName} ${item.lastName} (${item.email})`"
            },
            {
              "key": "amount",
              "label": "Amount",
              "formatterExpression": "",
              "customComponent": true,
              "sortable": true,
              "thStyle": "text-align: right; width:20%; padding-right: 1.5rem"
            },
            {
              "key": "description",
              "label": "Reason"
            },
            {
              "key": "location",
              "label": "Location",
              "hidden": true
            },
            {
              "key": "actions",
              "label": " ",
              "customComponent": true,
              "thStyle": "width: 5%",
              "class": "text-center"
            }
          ],
          "defaultValue": [
            "=([",
            "        {x: \"a\", data1: 30, data2: 4}, ",
            "        {x: \"b\", data1: 37, data2: 12},",
            "        {x: \"c\", data1: 22, data2: 8}",
            "])"
          ],
          "eventHandlers": [],
          "selectMode": "single",
          "dataSource": [
            "=$d('expenses-storage')",
            "//    .filter(expense => expense.$sharedBy ",
            "//        && expense.$sharedBy !== $collab.getLoggedUser().email",
            "//    )",
            ""
          ],
          "stacked": "md",
          "customComponent_actions": {
            "cid": "container-9",
            "type": "ContainerView",
            "dataType": "object",
            "layout": "block",
            "components": [
              {
                "cid": "button-10",
                "type": "ButtonView",
                "dataSource": "$parent",
                "buttonType": "button",
                "eventHandlers": [
                  {
                    "global": false,
                    "name": "@click",
                    "actions": [
                      {
                        "targetId": "edit-dialog1",
                        "name": "show",
                        "description": "",
                        "argument": "$d(this)"
                      }
                    ]
                  }
                ],
                "block": false,
                "disabled": false,
                "icon": "eye",
                "pill": true,
                "size": "=this.screenWidth < MD ? 'lg' : 'sm'",
                "hidden": false
              },
              {
                "cid": "button-11",
                "type": "ButtonView",
                "dataSource": "$parent",
                "buttonType": "button",
                "eventHandlers": [
                  {
                    "global": false,
                    "name": "@click",
                    "actions": [
                      {
                        "targetId": "$self",
                        "name": "setFieldData",
                        "description": "",
                        "condition": "confirm('Are you sure you want to reject this expense?')",
                        "argument": "'status', 'REJECTED'"
                      }
                    ]
                  }
                ],
                "block": false,
                "variant": "danger",
                "icon": "x",
                "disabled": false,
                "pill": true,
                "size": "=this.screenWidth < MD ? 'lg' : 'sm'",
                "hidden": false,
                "label": "Reject"
              },
              {
                "cid": "button-12",
                "type": "ButtonView",
                "dataSource": "$parent",
                "label": "Accept",
                "buttonType": "button",
                "eventHandlers": [
                  {
                    "global": false,
                    "name": "@click",
                    "actions": [
                      {
                        "targetId": "$self",
                        "name": "setFieldData",
                        "condition": "confirm('Are you sure you want to validate this expense?')",
                        "argument": "'status', 'ACCEPTED'"
                      }
                    ]
                  }
                ],
                "pill": true,
                "size": "=this.screenWidth < MD ? 'lg' : 'sm'",
                "variant": "success",
                "icon": "check2"
              },
              {
                "cid": "button-19",
                "type": "ButtonView",
                "dataSource": "$parent",
                "label": "Archive",
                "buttonType": "button",
                "eventHandlers": [
                  {
                    "global": false,
                    "name": "@click",
                    "actions": [
                      {
                        "targetId": "$self",
                        "name": "setFieldData",
                        "condition": "confirm('Are you sure you want to archive this expense?')",
                        "argument": "'status', 'ARCHIVED'",
                        "stopIfConditionIsFalse": true
                      },
                      {
                        "targetId": "archived-expenses-storage",
                        "name": "addData",
                        "argument": "$d(this)",
                        "condition": ""
                      },
                      {
                        "targetId": "expenses-storage",
                        "name": "removeData",
                        "argument": "$d(this)",
                        "condition": ""
                      }
                    ]
                  }
                ],
                "pill": true,
                "size": "=this.screenWidth < MD ? 'lg' : 'sm'",
                "disabled": "=$d(this).status !== 'ACCEPTED'",
                "variant": "secondary",
                "icon": "file-zip"
              }
            ],
            "defaultValue": "={}",
            "dataSource": "$parent",
            "eventHandlers": [],
            "direction": "row",
            "rowGap": "",
            "columnGap": "0.2rem",
            "justify": "center",
            "layoutClass": "w-100",
            "class": "",
            "hidden": false
          },
          "striped": true,
          "outlined": false,
          "bordered": false,
          "customComponent_amount": {
            "cid": "input-22",
            "type": "InputView",
            "dataType": "number",
            "inputType": "formatted-number",
            "size": "sm",
            "disabled": true,
            "eventHandlers": [],
            "dataSource": "$parent",
            "field": "amount",
            "numberStyle": "currency",
            "currency": "=$d(parent).currency",
            "class": "m-0",
            "currencyDisplay": "symbol",
            "horizontalLayout": false,
            "showInputOnClick": true,
            "layoutClass": "=this.screenWidth > MD ? 'text-right pr-3': ''"
          },
          "small": true,
          "notSelectable": true,
          "customComponent_date": {
            "cid": "datepicker-5",
            "type": "DatepickerView",
            "dataType": "date",
            "eventHandlers": [],
            "size": "sm",
            "dataSource": "$parent",
            "field": "date",
            "dateFormatOptions": "\"YYYY-MM-DD\"",
            "disabled": true
          },
          "customComponent_status": {
            "cid": "text-4",
            "type": "TextView",
            "dataType": "string",
            "tag": "div",
            "text": "=$c('globals').statusBadge($d(this))",
            "eventHandlers": [],
            "dataSource": "$parent",
            "field": "status"
          },
          "hidden": "=$d(this).length === 0",
          "emptyText": "",
          "class": "=this.screenWidth < MD ? 'fs-5' : ''"
        },
        {
          "cid": "text-3",
          "type": "TextView",
          "dataType": "string",
          "tag": "alert",
          "text": "No expenses to validate.",
          "eventHandlers": [],
          "hidden": "=$d('validation-table').length > 0"
        },
        {
          "cid": "edit-dialog1",
          "type": "DialogView",
          "title": "=`Expense by ${$d(this)?.email}`",
          "content": {
            "cid": "container-8",
            "type": "ContainerView",
            "dataType": "object",
            "layout": "block",
            "components": [
              {
                "cid": "image-2",
                "type": "ImageView",
                "blank": false,
                "display": "fluid",
                "layoutClass": "text-center",
                "eventHandlers": [],
                "dataSource": "$parent",
                "field": "photoUrl",
                "defaultImage": true
              },
              {
                "cid": "input-19",
                "type": "InputView",
                "dataType": "string",
                "inputType": "text",
                "size": "default",
                "disabled": true,
                "eventHandlers": [],
                "field": "id",
                "dataSource": "$parent",
                "label": "Id"
              },
              {
                "cid": "datepicker-4",
                "type": "DatepickerView",
                "dataType": "datetime",
                "eventHandlers": [],
                "label": "Date",
                "dataSource": "$parent",
                "field": "date"
              },
              {
                "cid": "input-20",
                "type": "InputView",
                "dataType": "string",
                "inputType": "text",
                "size": "default",
                "disabled": false,
                "eventHandlers": [],
                "field": "description",
                "dataSource": "$parent",
                "label": "Description",
                "numberStyle": "currency",
                "locale": "=$d('currency-selector11')"
              },
              {
                "cid": "currency-selector11",
                "type": "SelectView",
                "dataType": "string",
                "inputType": "text",
                "size": "default",
                "disabled": false,
                "eventHandlers": [],
                "field": "currency",
                "dataSource": "$parent",
                "label": "Currency",
                "options": [
                  "Intl.supportedValuesOf('currency').map(currency => ({",
                  "    text: currency + ' (' + ide.currencies.find(c => c.cc === currency)?.name + ')',",
                  "    value: currency",
                  "}))"
                ]
              },
              {
                "cid": "input-21",
                "type": "InputView",
                "dataType": "number",
                "inputType": "formatted-number",
                "size": "default",
                "disabled": false,
                "eventHandlers": [],
                "field": "amount",
                "dataSource": "$parent",
                "label": "Amount",
                "numberStyle": "currency",
                "currency": "=$d('currency-selector')",
                "currencyDisplay": "symbol",
                "state": "=$d(this) > 0",
                "invalidFeedback": "Not a valid amount"
              },
              {
                "cid": "button-9",
                "type": "ButtonView",
                "dataSource": "$parent",
                "label": "Update",
                "buttonType": "submit",
                "eventHandlers": [],
                "block": true,
                "variant": "primary",
                "icon": "check"
              }
            ],
            "defaultValue": "={}",
            "eventHandlers": [
              {
                "global": false,
                "name": "@submit",
                "actions": [
                  {
                    "targetId": "expenses-storage",
                    "name": "replaceData",
                    "description": "",
                    "condition": "",
                    "argument": "$d(this)"
                  },
                  {
                    "targetId": "edit-dialog1",
                    "name": "hide",
                    "description": "Close dialog",
                    "argument": "",
                    "condition": ""
                  }
                ]
              }
            ],
            "dataSource": "$parent",
            "form": true
          },
          "eventHandlers": [],
          "size": "xl",
          "scrollable": true
        }
      ],
      "defaultValue": "={}",
      "eventHandlers": []
    },
    {
      "cid": "archive",
      "type": "ContainerView",
      "dataType": "object",
      "layout": "block",
      "components": [
        {
          "cid": "time-series-chart-0",
          "type": "TimeSeriesChartView",
          "dataType": "array",
          "chartType": "bar",
          "width": "400",
          "height": "400",
          "timeSeriesList": [],
          "defaultValue": [
            "=([",
            "    {x:moment().format(), value1:23, value2:3}, ",
            "    {x:moment().add('hour', 2).format(), value1:30, value2:17}, ",
            "    {x:moment().add('hour', 3).format(), value1:41, value2:7}",
            "])"
          ],
          "eventHandlers": [],
          "dataSource": [
            "=$d('archived-expenses-storage').map(exp => {",
            "    return {",
            "        x: moment(exp.date).format('YYYY-MM-DD'),",
            "        amount: exp.amount",
            "    }",
            "})"
          ],
          "stacked": false
        },
        {
          "cid": "validation-table11",
          "type": "TableView",
          "dataType": "array",
          "fields": [
            {
              "key": "status",
              "label": "",
              "hidden": false,
              "customComponent": true,
              "class": "text-center",
              "thStyle": "width:5%"
            },
            {
              "key": "id",
              "label": "Id",
              "formatterExpression": "value => value.split('-')[0]",
              "hidden": true,
              "sortable": true
            },
            {
              "key": "date",
              "label": "Date",
              "customComponent": false,
              "sortable": true,
              "formatterExpression": "value => '<span style=\"white-space: nowrap;\">'+moment(value).format(\"YYYY-MM-DD\")+'</span>'",
              "thStyle": "width:10%"
            },
            {
              "key": "creator",
              "label": "Creator",
              "formatterExpression": "(value, key, item) => `${item.firstName} ${item.lastName} (${item.email})`"
            },
            {
              "key": "amount",
              "label": "Amount",
              "formatterExpression": "",
              "customComponent": true,
              "sortable": true,
              "thStyle": "text-align: right; width:20%; padding-right: 1.5rem"
            },
            {
              "key": "description",
              "label": "Reason"
            },
            {
              "key": "location",
              "label": "Location",
              "hidden": true
            },
            {
              "key": "actions",
              "label": " ",
              "customComponent": true,
              "thStyle": "width: 5%",
              "class": "text-center"
            }
          ],
          "defaultValue": [
            "=([",
            "        {x: \"a\", data1: 30, data2: 4}, ",
            "        {x: \"b\", data1: 37, data2: 12},",
            "        {x: \"c\", data1: 22, data2: 8}",
            "])"
          ],
          "eventHandlers": [],
          "selectMode": "single",
          "dataSource": [
            "=$d('archived-expenses-storage')",
            ""
          ],
          "stacked": "md",
          "customComponent_actions": {
            "cid": "container-14",
            "type": "ContainerView",
            "dataType": "object",
            "layout": "block",
            "components": [
              {
                "cid": "button-24",
                "type": "ButtonView",
                "dataSource": "$parent",
                "buttonType": "button",
                "eventHandlers": [
                  {
                    "global": false,
                    "name": "@click",
                    "actions": [
                      {
                        "targetId": "edit-dialog1",
                        "name": "show",
                        "description": "",
                        "argument": "$d(this)"
                      }
                    ]
                  }
                ],
                "block": false,
                "disabled": false,
                "icon": "eye",
                "pill": true,
                "size": "=this.screenWidth < MD ? 'lg' : 'sm'",
                "hidden": false
              }
            ],
            "defaultValue": "={}",
            "dataSource": "$parent",
            "eventHandlers": [],
            "direction": "row",
            "rowGap": "",
            "columnGap": "0.2rem",
            "justify": "center",
            "layoutClass": "w-100",
            "class": "",
            "hidden": false
          },
          "striped": true,
          "outlined": false,
          "bordered": false,
          "customComponent_amount": {
            "cid": "input-26",
            "type": "InputView",
            "dataType": "number",
            "inputType": "formatted-number",
            "size": "sm",
            "disabled": true,
            "eventHandlers": [],
            "dataSource": "$parent",
            "field": "amount",
            "numberStyle": "currency",
            "currency": "=$d(parent).currency",
            "class": "m-0",
            "currencyDisplay": "symbol",
            "horizontalLayout": false,
            "showInputOnClick": true,
            "layoutClass": "=this.screenWidth > MD ? 'text-right pr-3': ''"
          },
          "small": true,
          "notSelectable": true,
          "customComponent_date": {
            "cid": "datepicker-8",
            "type": "DatepickerView",
            "dataType": "date",
            "eventHandlers": [],
            "size": "sm",
            "dataSource": "$parent",
            "field": "date",
            "dateFormatOptions": "\"YYYY-MM-DD\"",
            "disabled": true
          },
          "customComponent_status": {
            "cid": "text-9",
            "type": "TextView",
            "dataType": "string",
            "tag": "div",
            "text": "=$c('globals').statusBadge($d(this))",
            "eventHandlers": [],
            "dataSource": "$parent",
            "field": "status"
          },
          "hidden": "=$d(this).length === 0",
          "emptyText": "",
          "class": "=this.screenWidth < MD ? 'fs-5' : ''"
        }
      ],
      "defaultValue": "={}",
      "eventHandlers": []
    }
  ]
}